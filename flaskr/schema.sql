
DROP TABLE LOAIHANG;
DROP TABLE MATHANG;
DROP TABLE NHACUNGCAP  ;
DROP TABLE NGUOIDAIDIEN ;
DROP TABLE NGUYENVATLIEU ;
DROP TABLE CAPNHATGIA ;
DROP TABLE PHANXUONG ;
DROP TABLE LENHSANXUAT ;
DROP TABLE SANXUAT ;
DROP TABLE PHIEUXUATNVL ;
DROP TABLE PHIEUTRANVL ;
DROP TABLE PHIEUNHAPTP ;
DROP TABLE DINHMUC ;
DROP TABLE XUATNVL ;
DROP TABLE NHAPKHO ;
DROP TABLE TRANVL ;

DROP TABLE IF EXISTS user;
DROP TABLE IF EXISTS post;

CREATE TABLE user (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL
);

CREATE TABLE post (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  author_id INTEGER NOT NULL,
  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  title TEXT NOT NULL,
  body TEXT NOT NULL,
  FOREIGN KEY (author_id) REFERENCES user (id)
);

CREATE TABLE LOAIHANG(
    MSLOAI VARCHAR2(10) NOT NULL CONSTRAINT MSLOAI_PK PRIMARY KEY,
	TENLOAI VARCHAR2(20)
);


CREATE TABLE MATHANG(
    MSMH VARCHAR2(8) NOT NULL CONSTRAINT MSNH_PK PRIMARY KEY,
    TENMH VARCHAR2(20),
    MOTA VARCHAR2(40),
    MATHANGDVT VARCHAR2(10) ,
    MSLOAI VARCHAR2(10),
    CONSTRAINT MATHANGDVT_CHECK CHECK (MATHANGDVT in ('Cai','Hop','Goi','Chai')),
    CONSTRAINT MATHANG_MSLOAI_FORE_kEY FOREIGN KEY (MSLOAI) REFERENCES LOAIHANG(MSLOAI)
--     CONSTRAINT MSHH_FORMAT_CHECK CHECK (REGEX(MSMH, '[A-Z][A-Z][A-Z][0-9][0-9][0-9][0-9][0-9]'))
);

INSERT INTO LOAIHANG VALUES('NC', 'Nuoc cham');
INSERT INTO LOAIHANG VALUES('DLA', 'Dong lanh');
INSERT INTO LOAIHANG VALUES('TRA', 'Tra');


-- INSERT INTO MATHANG
INSERT INTO MATHANG VALUES('NCH01234', 'Tuong ot', 'Gia vi thuc pham', 'Chai', 'NC');
INSERT INTO MATHANG VALUES('NCH01335', 'Nuoc mam', 'Gia vi thuc pham', 'Chai', 'NC');
INSERT INTO MATHANG VALUES('DLA11224', 'Cha gio', 'Thuc pham', 'Goi', 'DLA');
INSERT INTO MATHANG VALUES('DLA34224', 'Ha cao', 'Thuc pham', 'Goi', 'DLA');
INSERT INTO MATHANG VALUES('TRA11112', 'Tra xanh', 'Thuc uong', 'Hop', 'TRA');
INSERT INTO MATHANG VALUES('TRA43152', 'Tra kho qua', 'Thuc uong', 'Hop', 'TRA');


CREATE TABLE NHACUNGCAP(
     MSNCC VARCHAR2(8) NOT NULL CONSTRAINT MSNCC_PK PRIMARY KEY,
     TENNCC VARCHAR2(40),
     DIACHI VARCHAR2(50)
);
--
--
CREATE TABLE NGUOIDAIDIEN(
    MSNCC VARCHAR2(8) NOT NULL,
    TENNDD VARCHAR2(20) NOT NULL,
    SODT NUMBER(10) UNIQUE,
    CONSTRAINT NGUOIDAIDIEN_MSNCC_FK FOREIGN KEY (MSNCC) REFERENCES NHACUNGCAP(MSNCC)
--     CONSTRAINT SDT_FORMAT_CHECK CHECK (REGEXP_LIKE(SODT, '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'))
);
--
--
CREATE TABLE NGUYENVATLIEU(
    MSNVL VARCHAR2(10) NOT NULL CONSTRAINT MSNVL_PK PRIMARY KEY,
    TENNVL VARCHAR2(40) NOT NULL,
    MOTA VARCHAR2(40),
    DVT VARCHAR2(3),
    SLTON INT,
    CONSTRAINT NGUYENVATLIEUDVT_CHECK CHECK (DVT in ('kg', 'g', 'mg', 'm', 'mm', 'lit', 'ml')),
    CONSTRAINT SLTON CHECK( SLTON >= 0 )
);

--
CREATE TABLE CAPNHATGIA(
	MSNVL VARCHAR2(10) NOT NULL,
	MSNCC VARCHAR2(8) NOT NULL,
	GIA NUMBER(10, 2) NOT NULL,
	CONSTRAINT MSNCC_MSNVL_FK FOREIGN KEY (MSNVL) REFERENCES NGUYENVATLIEU(MSNVL),
	CONSTRAINT CAPNHATGIA_MSNCC_FK FOREIGN KEY (MSNCC) REFERENCES NHACUNGCAP(MSNCC),
	PRIMARY KEY (MSNCC, MSNVL)
);
--
CREATE TABLE PHANXUONG(
    MSPX VARCHAR2(12) NOT NULL CONSTRAINT MSPX_PK PRIMARY KEY,
    TENPX VARCHAR2(30)
);

--
CREATE TABLE LENHSANXUAT(
    MSLENH  VARCHAR2(10) NOT NULL CONSTRAINT MSLENH_PK PRIMARY KEY,
    NGAYLSX DATEDATE,
    MSPX  VARCHAR2(12),
    CONSTRAINT LENHSANXUAT_MSPX_FK FOREIGN KEY (MSPX) REFERENCES PHANXUONG(MSPX)
);

--
CREATE TABLE SANXUAT(
	MSLENH VARCHAR2(10) NOT NULL,
	MSMH VARCHAR2(8) NOT NULL,
	SOLUONG INT,
	NGAYSANXUAT DATE,
	CONSTRAINT SANXUAT_MSLENH_FK FOREIGN KEY (MSLENH) REFERENCES LENHSANXUAT(MSLENH),
	CONSTRAINT SANXUAT_MSMH_FK FOREIGN KEY (MSMH) REFERENCES MATHANG(MSMH),
	PRIMARY KEY (MSLENH, MSMH)
);
--
--
CREATE TABLE PHIEUXUATNVL(
    MSPX  VARCHAR2(12) CONSTRAINT PK_PX_MSPX PRIMARY KEY,
    NGAYXUAT DATEDATE,
    MSLENH VARCHAR2(10),
-- 	CONSTRAINT MSPX_FORMAT_CHECK CHECK (REGEXP_LIKE(MSPX, 'PX[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')),
    CONSTRAINT PHIEUXUATNVL_MSLENH_FK FOREIGN KEY (MSLENH) REFERENCES LENHSANXUAT(MSLENH)
);
--
-- se
create table PHIEUTRANVL(
	MSPT VARCHAR2(12) CONSTRAINT PK_PTNVL PRIMARY KEY,
	NGAYTRA DateDATE,
	MSLENH VARCHAR2(10),
-- 	CONSTRAINT MSPT_FORMAT_CHECK CHECK (REGEXP_LIKE(MSPT, 'PT[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')),
	CONSTRAINT FK_PT_MSLENH FOREIGN KEY (MSLENH) REFERENCES LENHSANXUAT(MSLENH)
);

--
create table PHIEUNHAPTP(
	MSPN VARCHAR2(12) CONSTRAINT PK_PNTP PRIMARY KEY,
	NGAYTRA DateDATE,
	MSLENH VARCHAR2(10),
-- 	CONSTRAINT MSPN_FORMAT_CHECK CHECK (REGEXP_LIKE(MSPN, 'PN[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')),
	CONSTRAINT FK_PN_MSLENH FOREIGN KEY (MSLENH) REFERENCES LENHSANXUAT(MSLENH)
);


create table DINHMUC(
	MSMH VARCHAR2(10) ,
	MSNVL VARCHAR2(10),
	NGAYAD DateDATE,
	SOLUONG INT CONSTRAINT SLD_CHECK CHECK(SOLUONG > 0),
	PRIMARY KEY (MSMH, MSNVL),
	CONSTRAINT FK_DM_MSMH FOREIGN KEY (MSMH) REFERENCES MATHANG(MSMH),
	CONSTRAINT FK_DM_MSNVL FOREIGN KEY (MSNVL) REFERENCES NGUYENVATLIEU(MSNVL)
);
--
--
create table XUATNVL(
	MSPX VARCHAR2(12),
	MSNVL VARCHAR2(10),
	SOLUONG INT CONSTRAINT SLX_CHECK CHECK(SOLUONG > 0),
	CONSTRAINT FK_XNVL_MSPX FOREIGN KEY (MSPX) REFERENCES PHIEUXUATNVL(MSPX),
	CONSTRAINT FK_XNVL_MSNVL FOREIGN KEY (MSNVL) REFERENCES NGUYENVATLIEU(MSNVL),
	PRIMARY KEY (MSPX, MSNVL)
);
--
--
create table NHAPKHO(
	MSPN VARCHAR2(12) NOT NULL,
	MSMH VARCHAR2(10),
	SOLUONGSX INT NOT NULL CONSTRAINT SOLUONGSX_CHECK CHECK(SOLUONGSX > 0),
	SOLUONGCL INT,
	CONSTRAINT FK_NP_MSPX FOREIGN KEY (MSPN) REFERENCES PHIEUNHAPTP(MSPN),
	CONSTRAINT FK_NP_MSMH FOREIGN KEY (MSMH) REFERENCES MATHANG(MSMH),
	PRIMARY KEY (MSPN, MSMH)
);
--
--
create table TRANVL(
	MSPT VARCHAR2(12),
	MSNVL VARCHAR2(10),
	SOLUONG INT CONSTRAINT SLT_CHECK CHECK(SOLUONG > 0),
	CONSTRAINT FK_TNVL_MSPT FOREIGN KEY (MSPT) REFERENCES PHIEUTRANVL(MSPT),
	CONSTRAINT FK_TNVL_MSNVL FOREIGN KEY (MSNVL) REFERENCES NGUYENVATLIEU(MSNVL),
	PRIMARY KEY (MSPT, MSNVL)
);
--
-- INSERT INTO LOAIHANG
-- MSLH BELONG (NUOC CHAM: NC, Thuc pham dong lanh: DlA, TRÃ€: TRA);




-- INSERT INTO NHACUNGCAP
INSERT INTO NHACUNGCAP VALUES('N130051', 'Cong ty TNHH Thuc pham Vissan', Null);
INSERT INTO NHACUNGCAP VALUES('N130052', 'Cong ty TNHH Thuc pham Hoang Dong', Null);
INSERT INTO NHACUNGCAP VALUES('N130053', 'Cong Ty Xua Khau Rau Cu Tien Giang', Null);
INSERT INTO NHACUNGCAP VALUES('N130054', 'Cong ty TNHH Thuc pham Vissan', Null);


-- INSERT INTO NGUOIDAIDIEN
INSERT INTO NGUOIDAIDIEN VALUES('N130051', 'Nguyen Xuan Hoang', 1234567891);
INSERT INTO NGUOIDAIDIEN VALUES('N130052', 'Tran Van Anh', 1234567882);
INSERT INTO NGUOIDAIDIEN VALUES('N130053', 'Tran Dang Tien', 1234567873);
INSERT INTO NGUOIDAIDIEN VALUES('N130054', 'Nguyen Hoang Kim Anh', 1234567864);


-- INSERT INTO NGUYENVATLIEU
INSERT INTO NGUYENVATLIEU VALUES('OT1234', 'Ot', 'Gia vi', 'kg', 1000);
INSERT INTO NGUYENVATLIEU VALUES('TH5264', 'Thit heo', 'Gia vi', 'kg', 2000);
INSERT INTO NGUYENVATLIEU VALUES('DU6873', 'Duong', 'Gia vi', 'kg', 2500);
INSERT INTO NGUYENVATLIEU VALUES('MU6873', 'Muoi', 'Gia vi', 'kg', 3000);
INSERT INTO NGUYENVATLIEU VALUES('TR6873', 'Tra xanh', 'Gia vi', 'kg', 10000);


-- INSERT INTO CAPNHATGIA
INSERT INTO CAPNHATGIA VALUES('OT1234', 'N130051', 11000);
INSERT INTO CAPNHATGIA VALUES('TH5264', 'N130052', 100000);
INSERT INTO CAPNHATGIA VALUES('DU6873', 'N130053', 15000);
INSERT INTO CAPNHATGIA VALUES('MU6873', 'N130054', 8000);
INSERT INTO CAPNHATGIA VALUES('TR6873', 'N130054', 50000);


-- INSERT INTO PHANXUONG
INSERT INTO PHANXUONG VALUES('PX001', 'Phan xuong nuoc cham 1');
INSERT INTO PHANXUONG VALUES('PX002', 'Phan xuong nuoc cham 2');
INSERT INTO PHANXUONG VALUES('PX003', 'Phan xuong thuc pham dong lanh');
INSERT INTO PHANXUONG VALUES('PX004', 'Phan xuong tra');



-- INSERT INTO LENHSANXUAT

INSERT INTO LENHSANXUAT VALUES('MSL1002', DATE('08-01-2021', 'dd-mm-yyyy'), 'PX002');
INSERT INTO LENHSANXUAT VALUES('MSL1003', DATE('09-01-2021', 'dd-mm-yyyy'), 'PX002');
INSERT INTO LENHSANXUAT VALUES('MSL1004', DATE('20-01-2021', 'dd-mm-yyyy'), 'PX002');
INSERT INTO LENHSANXUAT VALUES('MSL1005', DATE('25-01-2021', 'dd-mm-yyyy'), 'PX002');
INSERT INTO LENHSANXUAT VALUES('MSL1006', DATE('30-01-2021', 'dd-mm-yyyy'), 'PX002');

 -- INSERT INTO SANXUAT

INSERT INTO SANXUAT VALUES('MSL1002', 'NCH01234', 140,  DATE('08-01-2021', 'dd-mm-yyyy'));
INSERT INTO SANXUAT VALUES('MSL1003', 'NCH01234', 130,  DATE('09-01-2021', 'dd-mm-yyyy'));
INSERT INTO SANXUAT VALUES('MSL1004', 'NCH01234', 140,  DATE('20-01-2021', 'dd-mm-yyyy'));
INSERT INTO SANXUAT VALUES('MSL1005', 'NCH01234', 130,  DATE('25-01-2021', 'dd-mm-yyyy'));
INSERT INTO SANXUAT VALUES('MSL1006', 'NCH01234', 140,  DATE('30-01-2021', 'dd-mm-yyyy'));




-- INSERT INTO PHIEUXUATNVL
INSERT INTO PHIEUXUATNVL VALUES('PX1000000002', DATE('06-01-2021', 'dd-mm-yyyy'), 'MSL1002');


-- INSERT INTO PHIEUTRANVL
INSERT INTO PHIEUTRANVL VALUES('PT1000000002', DATE('06-01-2021', 'dd-mm-yyyy'), 'MSL1002');


-- INSERT INTO PHIEUNHAPTP
INSERT INTO PHIEUNHAPTP VALUES('PN1000000002', DATE('07-01-2021', 'dd-mm-yyyy'), 'MSL1002');


-- INSERT INTO DINHMUC
INSERT INTO DINHMUC VALUES('NCH01234', 'OT1234', DATE('06-01-2021', 'dd-mm-yyyy'), 500);


-- INSERT INTO XUATNVL
INSERT INTO XUATNVL VALUES('PX1000000002', 'OT1234', 500);


-- INSERT INTO NHAPKHO
INSERT INTO NHAPKHO VALUES('PN1000000002', 'NCH01234', 50, NULL);

-- INSERT INTO TRANVL
INSERT INTO TRANVL VALUES('PT1000000002', 'OT1234', 500);



--
--
